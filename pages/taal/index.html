<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="This year at Malhar, we hope to provide opportunities for pupils to realise and exceed their full potential. The sky is not the limit; we can transcend together."
    />

    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />

    <meta name="author" content="Malhar Computers Team" />
    <meta name="og:title" content="Malhar'22" />
    <meta
      name="og:description"
      content="Malhar is the inter-collegiate festival of
    St. Xavier's College (Autonomous), Mumbai"
    />
    <meta name="og:url" content="https://www.facebook.com/Malharfest" />
    <meta name="og:site_name" content="https://www.facebook.com/Malharfest" />

    <link rel="stylesheet" href="./style.css" />
    <title>Taal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://api.fontshare.com/v2/css?f[]=clash-display@400,300&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://api.fontshare.com/v2/css?f[]=clash-grotesk@200,400,600,300,500&display=swap"
      rel="stylesheet"
    />

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../../favicon_package_v0.16/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../../favicon_package_v0.16/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../../favicon_package_v0.16/favicon-16x16.png"
    />
    <link rel="manifest" href="../../favicon_package_v0.16/site.webmanifest" />
    <link
      rel="mask-icon"
      href="../../favicon_package_v0.16/safari-pinned-tab.svg"
      color="#5bbad5"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Overpass:wght@600&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Spectral:wght@300&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Krona+One&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Khula:wght@800&family=Overpass+Mono:wght@300;400&family=Overpass:wght@900&display=swap"
      rel="stylesheet"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" src="./script.js"></script>

    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
      integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
      crossorigin="anonymous"
    />
  </head>

  <body style="overflow-x: hidden">
    <nav id="nav" class="navbar">
      <div class="max-width">
        <ul class="menu">
          <li>
            <a
              href="../../index.html"
              class="menu-btn hover-underline-animation close_nav"
              >Home</a
            >
          </li>

          <li>
            <a
              href="https://linktr.ee/malharfest"
              class="menu-btn hover-underline-animation close_nav"
              >Announcements</a
            >
          </li>
          <li>
            <a
              href="../events/index.html"
              class="menu-btn hover-underline-animation close_nav"
              >Events</a
            >
          </li>
          <!-- <li>
            <a
              href="https://docs.google.com/forms/d/e/1FAIpQLScY_yvIGfKSykuSxf8IxsjCkbkXOEXK_RIXYqgblZZD_0DKCw/viewform"
              class="menu-btn hover-underline-animation close_nav"
              >Registration</a
            >
          </li> -->
          <li>
            <a
              href="../conclave/index.html"
              class="menu-btn hover-underline-animation close_nav"
              >Conclave</a
            >
          </li>
          <li>
            <a
              href="https://blog.malharfest.in"
              class="menu-btn hover-underline-animation close_nav"
              >Blog</a
            >
          </li>
          <li>
            <a
              href="../contact/index.html"
              class="menu-btn hover-underline-animation close_nav"
              >Contact</a
            >
          </li>
        </ul>
        <div class="menu-btn">
          <svg
            class="ham hamRotate ham4"
            viewBox="0 0 100 100"
            width="80"
            onclick="this.classList.toggle('active')"
          >
            <path
              class="line top"
              d="m 70,33 h -40 c 0,0 -8.5,-0.149796 -8.5,8.5 0,8.649796 8.5,8.5 8.5,8.5 h 20 v -20"
            />
            <path class="line middle" d="m 70,50 h -40" />
            <path
              class="line bottom"
              d="m 30,67 h 40 c 0,0 8.5,0.149796 8.5,-8.5 0,-8.649796 -8.5,-8.5 -8.5,-8.5 h -20 v 20"
            />
          </svg>
        </div>

        <!-- this may look stupid but do not touch it 
      (flexbox-related) -->
        <span class="nav-lol">ignore </span>
      </div>
    </nav>

    <!-- skip links -->
    <a href="#maincontent" class="SkipLinkText">Skip to main Content </a>

    <main id="maincontent">
      <p role="alert" class="visually-hidden">
        Use Left and Right Arrow keys to navigate between pages in the flip
        book. Press ALT+P to hear the audio book
      </p>
      <div
        class="magazine"
        style="margin-bottom: 5%; position: relative"
        role="region"
        aria-label="magazine Flip Book"
      >
        <h1 class="taal-title">Taal</h1>
        <h2 class="taal-subtitle">Use the corners to navigate</h2>
        <!-- <figure><i>Use the corners to navigate</i></figure> -->

        <!-- magazine -->

        <div class="flipbook-viewport">
          <div class="container" style="width: 100%">
            <div class="flipbook" style="width: 1000px;">
              <div
                style="background-image: url(./images/Taal_Draft_1-1-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_2-2-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_3-3-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_4-4-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_5-5-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_6-6-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_7-7-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_8-8-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_9-9-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_10-10-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_11-11-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_12-12-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_13-13-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_14-14-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_15-15-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_16-16-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_17-17-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_18-18-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_19-19-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_20-20-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_21-21-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_22-22-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_23-23-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_24-24-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_25-25-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_26-26-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_27-27-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_28-28-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_29-29-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_30-30-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_31-31-1.png)"
              ></div>
              <div
                style="background-image: url(./images/Taal_Draft_32-end-1.png)"
              ></div>
              <div style="background-image: url(./images/33.jpg)"></div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="audiobook"
        style="position: relative"
        role="region"
        aria-label="magazine audiobook"
      >
        <h1>TAAL AUDIOBOOK</h1>
        <!-- Audio player -->
        <div class="player">
          <audio class="player__audio viewer">
            <source
              src="Taal Audiobook.mp3"
              type="audio/mpeg"
              data-trackid="1"
            />
            <p role="alert">Your browser does not support the audio element.</p>
          </audio>
          <div class="song-panel">
            <div class="song-info">
              <div class="song-info__title">Taal Audiobook</div>
              <div class="song-info__artist">Malhar'21</div>
              <div
                class="progress"
                role="progressbar"
                aria-valuemin="0"
                aria-valuemax="100"
              >
                <div class="progress__filled"></div>
              </div>
            </div>
          </div>
          <div class="player-controls">
            <div class="spinner">
              <div
                class="spinner__disc"
                style="background-image: url(./images/TAAL\ 2021\ FINAL-01.png)"
              >
                <div class="center__disc"></div>
              </div>
            </div>
            <button class="backward">
              <i
                class="fas fa-backward fa-2x"
                title="Start from beginning"
                aria-label="Start from beginning"
              ></i>
            </button>
            <button class="play" title="Play/Pause (ALT+P)" aria-label="Play">
              <i class="fas fa-play fa-3x"></i>
              <span class="pause left"></span>
              <span class="pause right" accesskey="p" title="ALT+P"></span>
            </button>
            <button
              title="Fast Forward"
              aria-label="Fast Forward"
              class="forward"
              style="opacity: 0; visibility: hidden"
            >
              <i class="fas fa-forward fa-2x"></i>
            </button>
          </div>
        </div>
      </div>

      <script type="text/javascript">
        // for iphone SE and small af devices
        if ($(window).width() < 321) {
          turn = new TurnJS(".flipbook", {
            display: "single",

            acceleration: true,

            // Width
            width: 270,
            // Height
            height: 430,
            // Elevation
            elevation: 50,
            // Enable gradients
            gradients: true,
            // Auto center this flipbook
            autoCenter: true,
          });
        }



        // for large mobiles
        else if ($(window).width() > 321 && $(window).width() < 501) {
          turn = new TurnJS(".flipbook", {
            display: "single",

            acceleration: true,

            // Width
            width: 351,
            // Height
            height: 500,
            // Elevation
            elevation: 50,
            // Enable gradients
            gradients: true,
            // Auto center this flipbook
            autoCenter: true,
          });
        }


        // for desktop
        else {
          turn = new TurnJS(".flipbook", {
            display: "single",

            acceleration: true,

            // Width
            width: 550,
            // Height
            height: 750,
            // Elevation
            elevation: 50,
            // Enable gradients
            gradients: true,
            // Auto center this flipbook
            autoCenter: true,
          });
        }

        $(window).bind("keydown", function (e) {
          if (e.keyCode == 37) $(".flipbook").turn("previous");
          else if (e.keyCode == 39) $(".flipbook").turn("next");
        });
      </script>

      <style>
        .flipbook-viewport {
          width: 100%;
          height: 85%;
        }

        @media (min-width: 701px) {
          .flipbook-viewport {
            width: 100%;
            height: 65%;
            margin-top: 2rem;
          }

          /* .flipbook-viewport .container {
            position: relative;
            cursor: pointer;
            width: 100vw;
            left: 0%;
          } */

          .container {
            display: flex;
            width: 100vw;
            height: auto;
            margin: 0 auto;
            padding: 10px;
            position: relative;
            justify-content: center;
            align-items: center;
          }

          /* .flipbook {
            margin-left: auto;
            margin-right: auto;
            position: relative;
            left: 38.6%;
            transform: translateX(-50%);
          } */
        }

        /* Flipbook size for big phones */
        @media only screen and (min-width: 321px) and (max-width: 501px) {
          .flipbook-viewport {
            width: 100%;
            height: 65%;
            margin-top: 1.5rem;
          }

          /* .flipbook-viewport .container {
            position: relative;
            cursor: pointer;
            width: 100vw;
            left: 0;
          } */

          .container {
            display: flex;
            width: 100vw;
            height: auto;
            margin: 0 auto;
            padding: 10px;
            position: relative;
            justify-content: center;
            align-items: center;
          }

          /* .flipbook {
            margin-left: auto;
            margin-right: auto;
            left: 50%;
            transform: translateX(-50%);
          } */
        }

        /* Flipbook size for small af phones */
        @media only screen and (max-width: 321px) {
          .flipbook-viewport {
            width: 100%;
            height: 65%;
          }

          /* .flipbook-viewport .container {
            position: relative;
            cursor: pointer;
            width: 100vw;
            left: 0;
          } */

          .container {
            display: flex;
            width: 100vw;
            height: auto;
            margin: 0 auto;
            padding: 10px;
            position: relative;
            justify-content: center;
            align-items: center;
          }

          /* .flipbook {
            margin-left: auto;
            margin-right: auto;
            left: 50%;
            transform: translateX(-50%);
          } */
        }

        .flipbook-viewport .flipbook {
          width: 10rem;
          height: 6rem;
        }

        .flipbook-viewport .page {
          width: 10rem;
          height: 6rem;
          background-color: white;
          background-repeat: no-repeat;
          background-size: 100% 100%;
        }

        .flipbook .page {
          box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }

        .flipbook-viewport .page img {
          user-select: none;
          margin: 0;
        }

        .flipbook-viewport .shadow {
          transition: box-shadow 0.5s;
          box-shadow: 0 0 20px #ccc;
        }
      </style>

      <script>
        /* TODO:
- ADD timer (currentTime and duration)
*/

        const tracks = [
          {
            id: "1",
            title: "Ukulele",
            artist: "Bensound",
            src: "https://www.bensound.com/bensound-music/bensound-ukulele.mp3",
            cover: "https://www.bensound.com/bensound-img/ukulele.jpg",
          },
        ];
        const player = document.querySelector(".player");
        const audio = player.querySelector(".player__audio");
        const audioSource = audio.querySelector("source");
        const songPanel = player.querySelector(".song-panel");
        const songTitle = player.querySelector(".song-info__title");
        const songArtist = player.querySelector(".song-info__artist");
        const backButton = player.querySelector(".backward");
        const playButton = player.querySelector(".play");
        const forwardButton = player.querySelector(".forward");
        const spinner = player.querySelector(".spinner");
        const spinnerDisc = player.querySelector(".spinner__disc");
        const progress = player.querySelector(".progress");
        const progressBar = player.querySelector(".progress__filled");

        let playing = false;
        let trackSwitch = false;

        const togglePlay = () => {
          // Play / pause the audio
          const method = audio.paused ? "play" : "pause";
          playing = audio.paused ? true : false;
          audio[method]();
        };

        const toggleSongPanel = () => {
          if (!trackSwitch) {
            // Scale the disc
            spinnerDisc.classList.toggle("scale");

            // Show / hide song panel
            songPanel.classList.toggle("playing");

            // Change button icon
            playButton.classList.toggle("playing");
          }
        };

        const startSpin = () => {
          // Start spinning the disc
          spinner.classList.add("spin");
        };

        const stopSpin = () => {
          // Stop spinning the disc
          const spin = document.querySelector(".spin");
          spin.addEventListener(
            "animationiteration",
            () => {
              if (!playing) {
                spin.style.animation = "none";
                spinner.classList.remove("spin");
                spin.style.animation = "";
              }
            },
            {
              once: true,
            }
          );
        };

        const handleProgress = () => {
          // Update the progress bar.
          const percent = (audio.currentTime / audio.duration) * 100;
          progressBar.style.flexBasis = `${percent}%`;

          // Skip to next track if at the end of the song.
          if (percent === 100) {
            trackSwitch = true;
            handleForwardButton();
          }
        };

        const handleBackButton = () => {
          if (audio.currentTime <= 3) {
            const currentTrackId = parseInt(audioSource.dataset.trackid);
            const previousTrackId =
              currentTrackId === 1 ? "10" : (currentTrackId - 1).toString();
            const previousTrack = tracks.find((o) => o.id === previousTrackId);
            changeTrack(previousTrack);
          } else {
            audio.currentTime = 0;
          }
        };

        const handleForwardButton = () => {
          const currentTrackId = parseInt(audioSource.dataset.trackid);
          const nextTrackId =
            currentTrackId === 10 ? "1" : (currentTrackId + 1).toString();
          const nextTrack = tracks.find((o) => o.id === nextTrackId);
          changeTrack(nextTrack);
        };

        const changeTrack = (track) => {
          if (playing) trackSwitch = true;
          audioSource.setAttribute("src", track.src);
          audioSource.dataset.trackid = track.id;
          songTitle.innerHTML = track.title;
          songArtist.innerHTML = track.artist;
          spinnerDisc.style.backgroundImage = `url(${track.cover})`;
          audio.load();
          if (playing) {
            audio.addEventListener(
              "canplay",
              () => {
                audio.play();
              },
              {
                once: true,
              }
            );
            audio.addEventListener(
              "play",
              () => {
                trackSwitch = false;
              },
              {
                once: true,
              }
            );
          }
        };

        function scrub(e) {
          const scrubTime = (e.offsetX / progress.offsetWidth) * audio.duration;
          audio.currentTime = scrubTime;
        }

        audio.addEventListener("play", startSpin);
        audio.addEventListener("play", toggleSongPanel);
        audio.addEventListener("pause", stopSpin);
        audio.addEventListener("pause", toggleSongPanel);
        audio.addEventListener("timeupdate", handleProgress);

        backButton.addEventListener("click", handleBackButton);
        playButton.addEventListener("click", togglePlay);
        forwardButton.addEventListener("click", handleForwardButton);

        let mousedown = false;
        progress.addEventListener("click", scrub);
        progress.addEventListener("mousemove", (e) => mousedown && scrub(e));
        progress.addEventListener("mousedown", () => (mousedown = true));
        progress.addEventListener("mouseup", () => (mousedown = false));
      </script>

      
    </main>
  </body>
</html>
